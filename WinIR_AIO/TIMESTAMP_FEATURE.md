# æ—¶é—´æˆ³åç¯¡æ”¹æ£€æµ‹åŠŸèƒ½æ–‡æ¡£

## æ¦‚è¿°

WinIR-AIO v2.0.1 æ–°å¢žäº†å¼ºå¤§çš„æ—¶é—´æˆ³åç¯¡æ”¹æ£€æµ‹åŠŸèƒ½ï¼Œèƒ½å¤Ÿè¯†åˆ«æ¶æ„è½¯ä»¶å¸¸ç”¨çš„æ—¶é—´æˆ³ç¯¡æ”¹æŠ€æœ¯ï¼ˆTimestompingï¼‰ï¼Œè¿™æ˜¯ä¸€ç§å¸¸è§çš„åå–è¯æ‰‹æ®µã€‚

## èƒŒæ™¯

### ä»€ä¹ˆæ˜¯ Timestompingï¼Ÿ
Timestomping æ˜¯æ¶æ„è½¯ä»¶ç”¨æ¥é€ƒé¿æ£€æµ‹çš„ä¸€ç§æŠ€æœ¯ï¼Œé€šè¿‡ä¿®æ”¹æ–‡ä»¶çš„æ—¶é—´æˆ³ï¼ˆåˆ›å»ºæ—¶é—´ã€ä¿®æ”¹æ—¶é—´ã€è®¿é—®æ—¶é—´ï¼‰æ¥ï¼š
- è®©æ¶æ„æ–‡ä»¶çœ‹èµ·æ¥åƒç³»ç»ŸåŽŸç”Ÿæ–‡ä»¶
- éšè—çœŸå®žçš„æ„ŸæŸ“æ—¶é—´
- é€ƒé¿åŸºäºŽæ—¶é—´çš„æ£€æµ‹è§„åˆ™

### ä¸ºä»€ä¹ˆéœ€è¦æ£€æµ‹ï¼Ÿ
ä¼ ç»Ÿçš„æ–‡ä»¶æ—¶é—´æˆ³å¯ä»¥è¢«è½»æ˜“ç¯¡æ”¹ï¼Œä½† Windows ç³»ç»Ÿä¸­å­˜åœ¨å¤šä¸ªæ—¶é—´æˆ³æºï¼Œæ¶æ„è½¯ä»¶å¾ˆéš¾åŒæ—¶ç¯¡æ”¹æ‰€æœ‰æºï¼Œé€šè¿‡äº¤å‰éªŒè¯å¯ä»¥å‘çŽ°å¼‚å¸¸ã€‚

## æŠ€æœ¯å®žçŽ°

### æ—¶é—´æˆ³æ•°æ®æº

1. **æ ‡å‡† NTFS æ—¶é—´æˆ³**
   - åˆ›å»ºæ—¶é—´ (Creation Time)
   - ä¿®æ”¹æ—¶é—´ (Modification Time)  
   - è®¿é—®æ—¶é—´ (Access Time)
   - æ˜“è¢«ç¯¡æ”¹ï¼Œä½†æ˜¯åŸºç¡€å‚è€ƒ

2. **$MFT (Master File Table) è®°å½•**
   - NTFS æ–‡ä»¶ç³»ç»Ÿå…ƒæ•°æ®
   - åŒ…å«æ–‡ä»¶çš„å¤šä¸ªæ—¶é—´æˆ³å‰¯æœ¬
   - æ›´éš¾ç¯¡æ”¹ï¼Œå¯ç”¨äºŽéªŒè¯

3. **Prefetch æ–‡ä»¶**
   - Windows é¢„è¯»å–ä¼˜åŒ–æœºåˆ¶
   - è®°å½•ç¨‹åºæ‰§è¡Œæ—¶é—´
   - ä½äºŽ `C:\Windows\Prefetch`
   - æä¾›ç‹¬ç«‹çš„æ‰§è¡Œæ—¶é—´è¯æ®

4. **USN Journal**
   - æ›´æ–°åºåˆ—å·æ—¥å¿—
   - è®°å½•æ–‡ä»¶ç³»ç»Ÿæ‰€æœ‰å˜æ›´
   - æä¾›å˜æ›´åŽ†å²è®°å½•

### å¼‚å¸¸æ£€æµ‹æ¨¡å¼

ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹ä»¥ä¸‹å¯ç–‘æ¨¡å¼ï¼š

1. **é€»è¾‘é”™è¯¯**
   - åˆ›å»ºæ—¶é—´æ™šäºŽä¿®æ”¹æ—¶é—´ï¼ˆç‰©ç†ä¸Šä¸å¯èƒ½ï¼‰
   - æ‰€æœ‰æ—¶é—´æˆ³å®Œå…¨ç›¸åŒï¼ˆæžä¸å¯»å¸¸ï¼‰

2. **æ—¶é—´å¼‚å¸¸**
   - æ—¶é—´æˆ³åœ¨æœªæ¥
   - æ—¶é—´æˆ³æ˜Žæ˜¾ä¸åˆç†ï¼ˆå¦‚1970å¹´ä¹‹å‰ï¼‰

3. **è¡Œä¸ºå¼‚å¸¸**
   - æ–‡ä»¶å¾ˆæ—§ï¼ˆ>5å¹´ï¼‰ä½†æœ€è¿‘è¢«è®¿é—®ï¼ˆ<7å¤©ï¼‰
   - å¯èƒ½è¡¨ç¤ºæ—§æ–‡ä»¶è¢«æ¶æ„åˆ©ç”¨

4. **æ•°æ®æºä¸åŒ¹é…**
   - Prefetch æ˜¾ç¤ºè¿è¡Œæ—¶é—´æ—©äºŽæ–‡ä»¶ä¿®æ”¹æ—¶é—´
   - MFT æ—¶é—´æˆ³ä¸Žæ ‡å‡†æ—¶é—´æˆ³ç›¸å·®è¶…è¿‡1åˆ†é’Ÿ
   - è¡¨æ˜Žæ—¶é—´æˆ³å¯èƒ½è¢«æ‰‹åŠ¨ä¿®æ”¹

## ä½¿ç”¨æŒ‡å—

### åœ¨æŒä¹…åŒ–æ£€æµ‹æ¨¡å—ä¸­ä½¿ç”¨

1. **å¯ç”¨æ£€æµ‹**
   ```
   å‹¾é€‰ [âœ“] æ£€æµ‹æ—¶é—´æˆ³å¼‚å¸¸
   ```

2. **æŸ¥çœ‹ç»“æžœ**
   - æ­£å¸¸ï¼šç»¿è‰² "âœ… æ­£å¸¸"
   - å¯ç–‘ï¼šæ©™è‰² "âš ï¸ å¯ç–‘"
   - æœªæ£€æµ‹ï¼šç°è‰² "-"

3. **è¯¦ç»†åˆ†æž**
   - å³é”®ç‚¹å‡»ä»»æ„æ–‡ä»¶è·¯å¾„
   - é€‰æ‹©"ðŸ” åˆ†æžæ—¶é—´æˆ³"æŸ¥çœ‹å®Œæ•´æŠ¥å‘Š
   - é€‰æ‹©"âš¡ å¿«é€Ÿæ£€æŸ¥æ—¶é—´æˆ³"è¿›è¡Œå¿«é€ŸéªŒè¯

4. **æŸ¥çœ‹å¼‚å¸¸è¯¦æƒ…**
   - å³é”®ç‚¹å‡»å¯ç–‘é¡¹çš„æ—¶é—´æˆ³çŠ¶æ€åˆ—
   - é€‰æ‹©"ðŸ“ æŸ¥çœ‹å¼‚å¸¸è¯¦æƒ…"

5. **å‘½ä»¤æ—¥å¿—çª—å£** (v2.0.1 æ–°å¢ž)
   - ç‚¹å‡»å·¥å…·æ "ðŸ“œ å‘½ä»¤æ—¥å¿—"æŒ‰é’®æ‰“å¼€æ—¥å¿—çª—å£
   - å³é”®èœå•ä¸­é€‰æ‹©"ðŸ“œ æ˜¾ç¤ºå‘½ä»¤æ—¥å¿—"
   - å®žæ—¶æ˜¾ç¤ºæ‰€æœ‰æ‰§è¡Œçš„å‘½ä»¤å’Œè¾“å‡º
   - æ”¯æŒè‡ªåŠ¨æ»šåŠ¨ã€ä¿å­˜æ—¥å¿—ã€æ¸…ç©ºæ—¥å¿—

### å‘½ä»¤æ—¥å¿—åŠŸèƒ½

å‘½ä»¤æ—¥å¿—çª—å£ä¼šæ˜¾ç¤ºæ—¶é—´æˆ³åˆ†æžè¿‡ç¨‹ä¸­æ‰§è¡Œçš„æ‰€æœ‰ç³»ç»Ÿå‘½ä»¤ï¼š

```
[16:45:23.123] CMD #001: èŽ·å–æ ‡å‡† NTFS æ—¶é—´æˆ³
$ os.stat('C:\Windows\System32\notepad.exe')
  âœ“ æˆåŠŸ

[16:45:23.456] CMD #002: èŽ·å– MFT æ—¶é—´æˆ³ä¿¡æ¯
$ fsutil usn readdata C:\Windows\System32\notepad.exe
  File ID: 0x0000000000000123
  Parent File ID: 0x0000000000000456
  Usn: 0x0000000000789abc
  âœ“ æˆåŠŸ

[16:45:23.789] CMD #003: æŸ¥è¯¢æ–‡ä»¶ WMI ä¿¡æ¯
$ WMI Query: SELECT * FROM CIM_DataFile WHERE Name='C:\\Windows\\System32\\notepad.exe'
  âœ“ æˆåŠŸ
```

åŠŸèƒ½ç‰¹ç‚¹ï¼š
- **å®žæ—¶æ˜¾ç¤º**ï¼šå‘½ä»¤æ‰§è¡Œæ—¶ç«‹å³æ˜¾ç¤º
- **å½©è‰²è¾“å‡º**ï¼šä¸åŒç±»åž‹ä¿¡æ¯ä½¿ç”¨ä¸åŒé¢œè‰²
- **è‡ªåŠ¨æ»šåŠ¨**ï¼šæ–°å‘½ä»¤è‡ªåŠ¨æ»šåŠ¨åˆ°è§†å›¾
- **ä¿å­˜åŠŸèƒ½**ï¼šå¯¼å‡ºå®Œæ•´æ—¥å¿—ä¾›åŽç»­åˆ†æž
- **å‘½ä»¤è®¡æ•°**ï¼šæ˜¾ç¤ºå·²æ‰§è¡Œçš„å‘½ä»¤æ€»æ•°

### æ€§èƒ½è€ƒè™‘

- å¯ç”¨æ—¶é—´æˆ³æ£€æµ‹ä¼šå¢žåŠ æ‰«ææ—¶é—´ï¼ˆçº¦20-30%ï¼‰
- å»ºè®®åœ¨æ€€ç–‘ç³»ç»Ÿè¢«å…¥ä¾µæ—¶ä½¿ç”¨
- å¯ä»¥å…ˆä¸å¯ç”¨ï¼Œå‘çŽ°å¯ç–‘é¡¹åŽå†å¯ç”¨è¯¦ç»†æ£€æŸ¥

## API ä½¿ç”¨

### ç‹¬ç«‹ä½¿ç”¨ TimestampAnalyzer

```python
from src.core.timestamp_analyzer import TimestampAnalyzer

analyzer = TimestampAnalyzer()

# å¿«é€Ÿæ£€æŸ¥
is_suspicious, anomalies = analyzer.check_file_timestamps("C:\\suspicious.exe")
if is_suspicious:
    print(f"å‘çŽ° {len(anomalies)} ä¸ªå¼‚å¸¸")
    for anomaly in anomalies:
        print(f"  - {anomaly}")

# èŽ·å–è¯¦ç»†åˆ†æž
summary = analyzer.get_summary("C:\\suspicious.exe")
print(summary)

# èŽ·å–æ‰€æœ‰æ—¶é—´æˆ³æº
all_timestamps = analyzer.get_all_timestamps("C:\\suspicious.exe")
```

## æ£€æµ‹ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šæ­£å¸¸æ–‡ä»¶
```
æ–‡ä»¶: C:\Windows\System32\notepad.exe
[æ ‡å‡†æ—¶é—´æˆ³]
  åˆ›å»º: 2023-06-15 10:23:45
  ä¿®æ”¹: 2023-06-15 10:23:45
  è®¿é—®: 2025-11-23 14:30:00
[OK] æœªå‘çŽ°æ—¶é—´æˆ³å¼‚å¸¸
```

### ç¤ºä¾‹2ï¼šå¯ç–‘æ–‡ä»¶
```
æ–‡ä»¶: C:\Temp\malware.exe
[æ ‡å‡†æ—¶é—´æˆ³]
  åˆ›å»º: 2010-01-01 00:00:00  â† å¯ç–‘
  ä¿®æ”¹: 2010-01-01 00:00:00  â† å¯ç–‘
  è®¿é—®: 2025-11-23 15:45:00
[Prefetch]
  æœ€åŽè¿è¡Œ: 2025-11-23 15:44:30
[å‘çŽ°å¼‚å¸¸]
  [WARNING] æ‰€æœ‰æ—¶é—´æˆ³ç›¸åŒï¼ˆå¯ç–‘ï¼‰
  [WARNING] æ–‡ä»¶å¾ˆæ—§ä½†æœ€è¿‘è¢«è®¿é—®ï¼ˆå¯ç–‘ï¼‰
  [WARNING] MFTä¸Žæ ‡å‡†åˆ›å»ºæ—¶é—´ä¸åŒ¹é…ï¼ˆå¯èƒ½è¢«ç¯¡æ”¹ï¼‰
```

## å±€é™æ€§

1. **éœ€è¦ç®¡ç†å‘˜æƒé™**
   - è®¿é—® $MFT å’Œ USN Journal éœ€è¦æå‡æƒé™
   - æŸäº›ç³»ç»Ÿæ–‡ä»¶å¯èƒ½æ— æ³•è®¿é—®

2. **æ€§èƒ½å¼€é”€**
   - æ·±åº¦åˆ†æžä¼šå¢žåŠ æ‰«ææ—¶é—´
   - å¤§é‡æ–‡ä»¶åˆ†æžå¯èƒ½æ¶ˆè€—è¾ƒå¤šèµ„æº

3. **è¯¯æŠ¥å¯èƒ½**
   - æŸäº›åˆæ³•è½¯ä»¶ä¹Ÿä¼šä¿®æ”¹æ—¶é—´æˆ³
   - ç³»ç»Ÿè¿˜åŽŸã€å¤‡ä»½æ¢å¤å¯èƒ½å¯¼è‡´æ—¶é—´æˆ³å¼‚å¸¸
   - éœ€è¦ç»“åˆå…¶ä»–è¯æ®ç»¼åˆåˆ¤æ–­

## æœªæ¥æ”¹è¿›

- [ ] æ”¯æŒæ‰¹é‡æ—¶é—´æˆ³åˆ†æžå¯¼å‡º
- [ ] æ·»åŠ æ—¶é—´çº¿å¯è§†åŒ–
- [ ] é›†æˆ $J (USN Journal) æ·±åº¦åˆ†æž
- [ ] æ”¯æŒ MACB æ—¶é—´çº¿ç”Ÿæˆ
- [ ] æ·»åŠ å·²çŸ¥æ¶æ„æ—¶é—´æˆ³æ¨¡å¼åº“

## å‚è€ƒèµ„æ–™

- [MITRE ATT&CK T1070.006 - Timestomp](https://attack.mitre.org/techniques/T1070/006/)
- [Windows NTFS Timestamps](https://docs.microsoft.com/en-us/windows/win32/sysinfo/file-times)
- [Digital Forensics: File System Timeline Analysis](https://www.sans.org/blog/digital-forensic-timeline-analysis/)

---

*Last Updated: 2025-11-23*
*Version: 1.0*
